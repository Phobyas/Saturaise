{% comment %}
section/predictive-search.liquid - Updated to use product-loop for consistent styling
{% endcomment %}

{%- if predictive_search.performed -%}
  {%- liquid
    assign has_products = false
    assign has_collections = false
    assign has_pages = false
    assign has_articles = false
    assign has_queries = false
    assign columns = 0
  
    if predictive_search.resources.products.size > 0
      assign has_products = true
    endif
  
    if predictive_search.resources.collections.size > 0
      assign has_collections = true
    endif
    if predictive_search.resources.pages.size > 0
      assign has_pages = true
    endif
    if predictive_search.resources.articles.size > 0
      assign has_articles = true
    endif
    if predictive_search.resources.queries.size > 0
      assign has_queries = true
    endif
  
    if has_collections or has_queries
      assign columns = columns | plus: 1
    endif
    if has_pages or has_articles
      assign columns = columns | plus: 1
    endif
  
    case columns
    when 1
      assign grid_width = 'span-12'
    when 2
      assign grid_width = 'span-6'
    endcase
  
  -%}
    <link rel="preload" href="{{ 'component-product-grid.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'component-product-grid.css' | asset_url }}"></noscript>
  
    <div class="predictive-search-results" id="predictive-search-results">
      <ul id="predictive-search-results-list"
          class="predictive-search__results-list grid__wrapper edge"
          role="listbox"
          aria-labelledby="predictive-search-products">
          
        <!-- Products -->
        {%- if has_products -%}
          <li class="span-12 auto">
            <!-- See All Products Link (before product loop) -->
            <div class="predictive-search__view-all a-right pt-2 pb-5">
              <a href="{{ routes.search_url }}?q={{ predictive_search.terms | url_encode }}&type=product" class="text-[16px] font-medium underline">
                {{ 'general.search.browse_all' | t }}
              </a>
            </div>
            
            <ul class="search__product-loop">
              {%- for product in predictive_search.resources.products -%}
                <li class="product-index" role="option">
                  {% comment %}
                    Use the main product-loop snippet for consistent styling and prices
                  {% endcomment %}
                  {% render 'product-loop', 
                    product: product,
                    grid_items: 2,
                    loading: 'lazy'
                  %}
                </li>
              {%- endfor -%}
            </ul>
          </li>
        {%- endif -%}
        
        <!-- Collections, Pages, Articles sections remain unchanged -->
        {%- if has_collections or has_pages or has_articles or has_queries -%}
          <li class="span-12 auto">
            <ul class="grid__wrapper edge">
              <!-- Collections -->
              {%- if has_collections -%}
                <li class="{{ grid_width }} sm-span-12 auto">
                  <h3 class="predictive-search__heading">{{ 'general.search.collections' | t }}</h3>
                  <ul class="predictive-search__results-list" role="group" aria-labelledby="predictive-search-collections">
                    {%- for collection in predictive_search.resources.collections -%}
                      <li class="predictive-search__results-list-item" role="option">
                        <a href="{{ collection.url }}" class="predictive-search__results-list-item-link">
                          <div class="predictive-search__results-list-item-content">
                            <p class="predictive-search__results-list-item-title">{{ collection.title }}</p>
                          </div>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </li>
              {%- endif -%}
              
              <!-- Pages -->
              {%- if has_pages -%}
                <li class="{{ grid_width }} sm-span-12 auto">
                  <h3 class="predictive-search__heading">{{ 'general.search.pages' | t }}</h3>
                  <ul class="predictive-search__results-list" role="group" aria-labelledby="predictive-search-pages">
                    {%- for page in predictive_search.resources.pages -%}
                      <li class="predictive-search__results-list-item" role="option">
                        <a href="{{ page.url }}" class="predictive-search__results-list-item-link">
                          <div class="predictive-search__results-list-item-content">
                            <p class="predictive-search__results-list-item-title">{{ page.title }}</p>
                          </div>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </li>
              {%- endif -%}
              
              <!-- Articles -->
              {%- if has_articles -%}
                <li class="{{ grid_width }} sm-span-12 auto">
                  <h3 class="predictive-search__heading">{{ 'general.search.articles' | t }}</h3>
                  <ul class="predictive-search__results-list" role="group" aria-labelledby="predictive-search-articles">
                    {%- for article in predictive_search.resources.articles -%}
                      <li class="predictive-search__results-list-item" role="option">
                        <a href="{{ article.url }}" class="predictive-search__results-list-item-link">
                          <div class="predictive-search__results-list-item-content">
                            <p class="predictive-search__results-list-item-title">{{ article.title }}</p>
                          </div>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </li>
              {%- endif -%}
              
              <!-- Search Queries -->
              {%- if has_queries -%}
                <li class="{{ grid_width }} sm-span-12 auto">
                  <h3 class="predictive-search__heading">{{ 'general.search.suggestions' | t }}</h3>
                  <ul class="predictive-search__results-list" role="group" aria-labelledby="predictive-search-queries">
                    {%- for query in predictive_search.resources.queries -%}
                      <li class="predictive-search__results-list-item" role="option">
                        <a href="{{ routes.search_url }}?q={{ query.text | url_encode }}" class="predictive-search__results-list-item-link">
                          <div class="predictive-search__results-list-item-content">
                            <p class="predictive-search__results-list-item-title">{{ query.styled_text }}</p>
                          </div>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </li>
              {%- endif -%}
            </ul>
          </li>
        {%- endif -%}
      </ul>
    </div>
{%- endif -%}